<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Backend Integration Test - RoadRescue360</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-button {
            background: #0056b3;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
            font-size: 16px;
            display: inline-block;
            text-decoration: none;
        }
        .test-button:hover {
            background: #004494;
        }
        .test-button.secondary {
            background: #28a745;
        }
        .test-button.secondary:hover {
            background: #218838;
        }
        .test-button.danger {
            background: #dc3545;
        }
        .test-button.danger:hover {
            background: #c82333;
        }
        .status {
            margin: 20px 0;
            padding: 15px;
            border-radius: 5px;
            background: #e8f5e8;
            border: 1px solid #4caf50;
        }
        .error {
            background: #ffebee;
            border: 1px solid #f44336;
            color: #c62828;
        }
        .warning {
            background: #fff3e0;
            border: 1px solid #ff9800;
            color: #e65100;
        }
        .success {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            color: #2e7d32;
        }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            border: 1px solid #e9ecef;
            max-height: 300px;
            overflow-y: auto;
        }
        .test-section {
            background: #f8f9fa;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
            border-left: 4px solid #0056b3;
        }
        .test-section.success {
            border-left-color: #28a745;
            background: #e8f5e8;
        }
        .test-section.error {
            border-left-color: #dc3545;
            background: #ffebee;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üîß Backend Integration Test - RoadRescue360</h1>
        <p>This page tests the integration between frontend and backend systems.</p>
        
        <div class="status" id="status">
            Ready to test backend integration. Click the buttons below to test each component.
        </div>
        
        <h3>System Status:</h3>
        <div class="test-section" id="frontend-status">
            <strong>Frontend Server:</strong> <span id="frontend-status-text">Testing...</span>
        </div>
        <div class="test-section" id="backend-status">
            <strong>Backend Server:</strong> <span id="backend-status-text">Testing...</span>
        </div>
        <div class="test-section" id="mongodb-status">
            <strong>MongoDB Database:</strong> <span id="mongodb-status-text">Testing...</span>
        </div>
        
        <h3>API Tests:</h3>
        <button class="test-button" onclick="testBackendConnection()">üîó Test Backend Connection</button>
        <button class="test-button" onclick="testServicesAPI()">üìã Test Services API</button>
        <button class="test-button" onclick="testTrackingAPI()">üìç Test Tracking API</button>
        <button class="test-button secondary" onclick="testCompleteWorkflow()">üîÑ Test Complete Workflow</button>
        <button class="test-button danger" onclick="clearAllData()">üóëÔ∏è Clear All Test Data</button>
        
        <h3>Test Results:</h3>
        <pre id="testResults">No tests run yet.</pre>
        
        <h3>System Information:</h3>
        <pre id="systemInfo">Loading system information...</pre>
    </div>

    <script>
        // Test backend connection
        async function testBackendConnection() {
            try {
                const response = await fetch('http://localhost:3000/api/services');
                const data = await response.text();
                
                if (response.status === 403) {
                    document.getElementById('backend-status').classList.add('success');
                    document.getElementById('backend-status-text').textContent = '‚úÖ Running (Authentication required)';
                    document.getElementById('testResults').textContent = `
Backend Connection Test: ‚úÖ SUCCESS
Status: ${response.status} ${response.statusText}
Response: ${data}
Note: Backend is running and responding (authentication required for full access)
                    `;
                } else {
                    document.getElementById('backend-status').classList.add('success');
                    document.getElementById('backend-status-text').textContent = '‚úÖ Running';
                    document.getElementById('testResults').textContent = `
Backend Connection Test: ‚úÖ SUCCESS
Status: ${response.status} ${response.statusText}
Response: ${data}
                    `;
                }
            } catch (error) {
                document.getElementById('backend-status').classList.add('error');
                document.getElementById('backend-status-text').textContent = '‚ùå Not Running';
                document.getElementById('testResults').textContent = `
Backend Connection Test: ‚ùå FAILED
Error: ${error.message}
Note: Make sure the backend server is running on port 3000
                `;
            }
        }
        
        // Test services API
        async function testServicesAPI() {
            try {
                const response = await fetch('http://localhost:3000/api/services', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.text();
                
                if (response.status === 403) {
                    document.getElementById('testResults').textContent = `
Services API Test: ‚úÖ SUCCESS (Authentication Required)
Status: ${response.status} ${response.statusText}
Response: ${data}
Note: API is working but requires authentication token
                    `;
                } else {
                    document.getElementById('testResults').textContent = `
Services API Test: ‚úÖ SUCCESS
Status: ${response.status} ${response.statusText}
Response: ${data}
                    `;
                }
            } catch (error) {
                document.getElementById('testResults').textContent = `
Services API Test: ‚ùå FAILED
Error: ${error.message}
                `;
            }
        }
        
        // Test tracking API
        async function testTrackingAPI() {
            try {
                const response = await fetch('http://localhost:3000/api/tracking/test123', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.text();
                
                if (response.status === 403) {
                    document.getElementById('testResults').textContent = `
Tracking API Test: ‚úÖ SUCCESS (Authentication Required)
Status: ${response.status} ${response.statusText}
Response: ${data}
Note: API is working but requires authentication token
                    `;
                } else {
                    document.getElementById('testResults').textContent = `
Tracking API Test: ‚úÖ SUCCESS
Status: ${response.status} ${response.statusText}
Response: ${data}
                    `;
                }
            } catch (error) {
                document.getElementById('testResults').textContent = `
Tracking API Test: ‚ùå FAILED
Error: ${error.message}
                `;
            }
        }
        
        // Test complete workflow
        async function testCompleteWorkflow() {
            // Set test booking data
            const testData = {
                service: 'fuel',
                serviceTitle: 'Fuel Delivery',
                servicePricing: 'Starting at ‚Çπ999',
                serviceDescription: 'Emergency fuel delivery service to get you back on the road.',
                serviceIcon: '<i class="fas fa-gas-pump"></i>',
                name: 'Test User',
                phone: '+91 9876543210',
                location: 'Sector 62, Noida, Uttar Pradesh 201301, India',
                vehicleInfo: 'Honda City - White - DL-01-AB-1234',
                time: 'ASAP',
                paymentMethod: 'Credit Card',
                notes: 'Test booking for integration testing',
                timestamp: new Date().toISOString(),
                trackingId: 'RR-' + Math.floor(Math.random() * 1000000)
            };
            
            // Store in localStorage
            localStorage.setItem('roadRescueBooking', JSON.stringify(testData));
            
            // Test backend connection
            await testBackendConnection();
            
            document.getElementById('testResults').textContent = `
Complete Workflow Test: ‚úÖ SUCCESS
1. ‚úÖ Test booking data created
2. ‚úÖ Data stored in localStorage
3. ‚úÖ Backend server responding
4. ‚úÖ Ready for track page testing

Test Data:
- Service: ${testData.serviceTitle}
- Tracking ID: ${testData.trackingId}
- Location: ${testData.location}

Next Steps:
1. Click "Go to Track Page" to test the complete workflow
2. Verify that the track page shows the correct service details
            `;
        }
        
        // Clear all test data
        function clearAllData() {
            localStorage.removeItem('roadRescueBooking');
            document.getElementById('testResults').textContent = 'All test data cleared.';
            document.getElementById('status').innerHTML = 'üóëÔ∏è All test data has been cleared.';
        }
        
        // Check frontend status
        function checkFrontendStatus() {
            document.getElementById('frontend-status').classList.add('success');
            document.getElementById('frontend-status-text').textContent = '‚úÖ Running on port 8001';
        }
        
        // Check MongoDB status
        async function checkMongoDBStatus() {
            try {
                // Try to connect to MongoDB (this is a simple test)
                const response = await fetch('http://localhost:3000/api/services');
                if (response.status === 403) {
                    document.getElementById('mongodb-status').classList.add('success');
                    document.getElementById('mongodb-status-text').textContent = '‚úÖ Connected (Backend responding)';
                } else {
                    document.getElementById('mongodb-status').classList.add('warning');
                    document.getElementById('mongodb-status-text').textContent = '‚ö†Ô∏è Status Unknown';
                }
            } catch (error) {
                document.getElementById('mongodb-status').classList.add('error');
                document.getElementById('mongodb-status-text').textContent = '‚ùå Not Connected';
            }
        }
        
        // Load system information
        function loadSystemInfo() {
            const systemInfo = `
Frontend Server: http://localhost:8001
Backend Server: http://localhost:3000
MongoDB: mongodb://localhost:27017/roadrescue360

Available Endpoints:
- GET /api/services (requires auth)
- POST /api/services (requires auth)
- GET /api/tracking/:id (requires auth)
- GET /api/users (requires auth)
- POST /api/payments (requires auth)

Authentication:
- All API endpoints require authentication
- Frontend currently uses localStorage for demo
- Backend ready for JWT token integration

Test Pages:
- /test-complete-workflow.html (Frontend workflow test)
- /debug-booking.html (Booking data debug)
- /test-backend-integration.html (This page)
            `;
            
            document.getElementById('systemInfo').textContent = systemInfo;
        }
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            checkFrontendStatus();
            checkMongoDBStatus();
            loadSystemInfo();
            
            // Auto-test backend connection
            setTimeout(() => {
                testBackendConnection();
            }, 1000);
        });
    </script>
</body>
</html>



